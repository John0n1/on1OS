# on1OS Security Configuration
# Advanced security settings and hardening options

# Kernel Security Features
CONFIG_SECURITY=y
CONFIG_SECURITY_DMESG_RESTRICT=y
CONFIG_SECURITY_PERF_EVENTS_RESTRICT=y
CONFIG_SECURITY_YAMA=y
CONFIG_SECURITY_YAMA_STACKED=y

# Memory Protection
CONFIG_HARDENED_USERCOPY=y
CONFIG_HARDENED_USERCOPY_FALLBACK=n
CONFIG_HARDENED_USERCOPY_PAGESPAN=y
CONFIG_FORTIFY_SOURCE=y
CONFIG_STATIC_USERMODEHELPER=y

# SLAB Hardening
CONFIG_SLAB_FREELIST_RANDOM=y
CONFIG_SLAB_FREELIST_HARDENED=y
CONFIG_SHUFFLE_PAGE_ALLOCATOR=y

# Address Space Layout Randomization
CONFIG_RANDOMIZE_BASE=y
CONFIG_RANDOMIZE_MEMORY=y
CONFIG_RANDOMIZE_KSTACK_OFFSET=y

# Control Flow Integrity
CONFIG_CFI_CLANG=y
CONFIG_CFI_ICALL_NORMALIZE_INTEGERS=y

# Stack Protection
CONFIG_STACKPROTECTOR=y
CONFIG_STACKPROTECTOR_STRONG=y
CONFIG_GCC_PLUGIN_STACKLEAK=y
CONFIG_STACKLEAK_TRACK_MIN_SIZE=100
CONFIG_STACKLEAK_METRICS=n
CONFIG_STACKLEAK_RUNTIME_DISABLE=n

# Integer Overflow Protection
CONFIG_UBSAN=y
CONFIG_UBSAN_TRAP=y
CONFIG_UBSAN_BOUNDS=y
CONFIG_UBSAN_SANITIZE_ALL=y

# Kernel Guard
CONFIG_VMAP_STACK=y
CONFIG_THREAD_INFO_IN_TASK=y

# Memory Management
CONFIG_STRICT_KERNEL_RWX=y
CONFIG_STRICT_MODULE_RWX=y
CONFIG_DEBUG_WX=y

# SMEP/SMAP (Supervisor Mode Execution/Access Prevention)
CONFIG_X86_SMAP=y
CONFIG_X86_SMEP=y
CONFIG_X86_UMIP=y

# Intel CET (Control-flow Enforcement Technology)
CONFIG_X86_INTEL_CET=y

# Spectre/Meltdown Mitigations
CONFIG_RETPOLINE=y
CONFIG_CPU_SRSO=y
CONFIG_MITIGATION_RFDS=y
CONFIG_MITIGATION_SPECTRE_BHI=y

# Disable Dangerous Features
# CONFIG_DEVMEM is not set
# CONFIG_DEVPORT is not set
# CONFIG_PROC_KCORE is not set
# CONFIG_COMPAT_VDSO is not set
# CONFIG_KEXEC is not set
# CONFIG_KEXEC_FILE is not set
# CONFIG_HIBERNATION is not set
# CONFIG_LEGACY_VSYSCALL_NATIVE is not set
# CONFIG_X86_VSYSCALL_EMULATION is not set
# CONFIG_MODIFY_LDT_SYSCALL is not set
# CONFIG_X86_16BIT is not set
# CONFIG_COMPAT is not set

# Network Security
CONFIG_NETWORK_SECMARK=y
CONFIG_NETFILTER=y
CONFIG_NETFILTER_ADVANCED=y
CONFIG_NETFILTER_NETLINK_ACCT=y

# Cryptographic API
CONFIG_CRYPTO_FIPS=y
CONFIG_CRYPTO_DRBG_MENU=y
CONFIG_CRYPTO_DRBG_HMAC=y
CONFIG_CRYPTO_DRBG_HASH=y
CONFIG_CRYPTO_DRBG_CTR=y

# TPM Support
CONFIG_TCG_TPM=y
CONFIG_TCG_TIS_CORE=y
CONFIG_TCG_TIS=y
CONFIG_TCG_TIS_SPI=y
CONFIG_TCG_TIS_I2C_CR50=y
CONFIG_TCG_CRBTPM=y

# Hardware Random Number Generator
CONFIG_HW_RANDOM=y
CONFIG_HW_RANDOM_TPM=y
CONFIG_HW_RANDOM_INTEL=y
CONFIG_HW_RANDOM_AMD=y

# Kernel Runtime Security Instrumentation
CONFIG_KASAN=n  # Too performance heavy for production
CONFIG_KFENCE=y
CONFIG_KFENCE_SAMPLE_INTERVAL=500

# Lockdown
CONFIG_SECURITY_LOCKDOWN_LSM=y
CONFIG_SECURITY_LOCKDOWN_LSM_EARLY=y
CONFIG_LOCK_DOWN_KERNEL_FORCE_CONFIDENTIALITY=y

# Load Pin
CONFIG_SECURITY_LOADPIN=y
CONFIG_SECURITY_LOADPIN_ENFORCE=y

# KASLR
CONFIG_RANDOMIZE_BASE=y
CONFIG_RANDOMIZE_MEMORY=y
